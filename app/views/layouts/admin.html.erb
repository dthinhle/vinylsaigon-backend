<!DOCTYPE html>
<html>
  <head>
    <title>Admin Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <!-- Material Icons CDN for sidebar icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <%= javascript_include_tag "application", "data-turbo-track": "reload" %>
  </head>
  <body class="bg-gray-50 min-h-screen overflow-x-hidden h-full">
    <!-- Topbar (Tailwind Admin style) -->
    <% if admin_signed_in? %>
      <header class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 shadow-sm flex items-center justify-between px-8 z-70" role="banner">
        <div class="flex items-center gap-4">
          <%= image_tag "logo.svg", alt: "Logo", class: "h-8 p-1" %>
          <span class="text-gray-500" aria-hidden="true">/</span>
          <span class="font-bold text-lg text-brand-700 hidden md:block" aria-label="Admin Panel">Admin Panel</span>
        </div>
        <div class="flex items-center gap-4">
          <%# TODO: Notification bell icon %>
          <%# <button class="-mb-2 relative cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary-500" aria-label="Notifications" tabindex="0">
            <span class="material-icons" aria-hidden="true">notifications</span>
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1" aria-label="3 unread notifications">3</span>
          </button> %>
          <div class="flex items-center gap-2" aria-label="User profile">
            <span class="material-icons text-gray-500" aria-hidden="true">account_circle</span>
            <span class="text-gray-700 font-medium">
              <%= current_admin.name %>
            </span>
          </div>
          <%= button_to "Logout", destroy_admin_session_path, method: :delete, class: "px-3 py-1.5 border-red-200 border text-red-600 text-sm rounded-lg hover:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-500", form: { class: "inline" }, "aria-label": "Logout" %>
        </div>
      </header>

      <!-- Sidebar + Main Content -->
      <div class="flex pt-16 w-full max-w-full min-h-screen" role="presentation">
        <!-- Sidebar (Tailwind Admin style) -->
        <div id="sidebar-container" class="transition-all duration-200 shrink-0" aria-hidden="false">
          <%= render "layouts/sidebar" %>
        </div>
        <!-- Main content -->
        <main class="flex-1 pt-8 px-8 transition-all duration-200 w-full max-w-full min-w-0 overflow-x-hidden <%= @sidebar_collapsed ? 'md:ml-16 ml-16' : 'md:ml-64 ml-64' %>" id="main-content" tabindex="-1" role="main" aria-label="Main content">
          <!-- Flash Messages -->
          <div id="flash">
            <% if flash.any? %>
              <% flash.each do |type, message| %>
                <%
                  alert_class, icon_name = case type.to_sym
                  when :notice, :info
                    [
                      "rounded-xl border border-sky-500 bg-sky-50 p-4 dark:border-sky-500/30 dark:bg-sky-500/15 mb-4 flex items-center gap-3 text-sky-500",
                      "info"
                    ]
                  when :alert, :error
                    [
                      "rounded-xl border border-amber-500 bg-amber-50 p-4 dark:border-amber-500/30 dark:bg-amber-500/15 mb-4 flex items-center gap-3 text-amber-500",
                      "error"
                    ]
                  when :success
                    [
                      "rounded-xl border border-success-500 bg-success-50 p-4 dark:border-success-500/30 dark:bg-success-500/15 mb-4 flex items-center gap-3 text-success-500",
                      "check_circle"
                    ]
                  else
                    [
                      "rounded-xl border border-gray-400 bg-gray-50 p-4 mb-4 flex items-center gap-3 text-gray-500",
                      "notifications"
                    ]
                  end
                %>
                <div class="<%= alert_class %>" role="alert" aria-live="polite">
                  <span class="-mt-0.5">
                    <span class="material-icons align-middle text-xl"><%= icon_name %></span>
                  </span>
                  <div class="block text-sm font-semibold">
                    <%= message %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <nav class="ml-4 text-gray-500 text-sm hidden md:block" aria-label="Breadcrumb">
            <%= content_for?(:breadcrumbs) ? yield(:breadcrumbs) : "" %>
          </nav>
          <%= yield %>
        </main>
      </div>
    <% else %>
      <div class="flex min-h-screen items-center justify-center">
        <div class="max-w-xs w-full" style="max-width:320px">
          <%= yield %>
        </div>
      </div>
    <% end %>
    <!-- Toast container for notifications -->
    <div data-controller="toast" data-toast-target="container"></div>
  </body>
</html>
