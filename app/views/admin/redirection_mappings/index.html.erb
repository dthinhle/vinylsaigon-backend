<div class="flex flex-col gap-4" data-controller="redirection-mappings-index">
  <%= render 'admin/shared/page_header',
    title: 'Redirection Mappings',
    button_text: 'Create Mapping',
    button_path: new_admin_redirection_mapping_path %>

  <div class="filter-wrapper w-full bg-white p-4 border border-gray-200 rounded-lg grid gap-4">
    <%= render_filter_chips(
      filter_params: @filter_params,
      filter_labels: @filter_labels,
      clear_path: admin_redirection_mappings_path
    ) %>

    <div class="w-full max-w-full">
      <%= form_with url: admin_redirection_mappings_path, method: :get, local: true, class: "flex flex-col md:flex-row md:items-end gap-2 md:gap-4 w-full max-w-full" do |f| %>
        <div class="flex flex-col md:flex-row gap-2 md:gap-4 flex-1">
          <div class="flex flex-col">
            <input type="search" name="q" value="<%= params[:q] %>" placeholder="Search by slug..." class="input input-bordered text-sm w-full max-w-full px-3 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-sky-500">
          </div>
        </div>
        <div class="flex flex-col justify-end">
          <button type="submit" class="btn btn-secondary text-sm px-3 py-2 rounded bg-gray-950 text-gray-50 hover:bg-gray-700 cursor-pointer">Filter</button>
        </div>
      <% end %>
    </div>
  </div>

  <div class="flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>

  <div class="overflow-x-auto w-full border border-gray-200 rounded-lg">
    <table class="w-full max-w-full divide-y divide-gray-200 table-auto">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 w-8">
            <input type="checkbox" class="accent-gray-700" data-action="change->redirection-mappings-index#toggleAll" data-redirection-mappings-index-target="toggleAllCheckbox">
          </th>
          <%= render_redirection_mapping_table_headers(params) %>
        </tr>
        <!-- Bulk Actions Row -->
        <tr class="bg-gray-50" data-redirection-mappings-index-target="bulkActionsRow">
          <td colspan="5" class="px-4">
            <button
              type="button"
              class="btn btn-danger my-2 px-2 py-2 rounded bg-red-600 text-white hover:bg-red-700 transition items-center justify-center hidden"
              data-redirection-mappings-index-target="deleteButton"
              data-action="click->redirection-mappings-index#deleteSelected"
              aria-label="Delete Selected"
              title="Delete Selected"
            >
              <span class="material-icons" style="font-size:1.25rem;" aria-hidden="true">delete</span>
              <span class='text-sm ml-2'>
                Delete selected rows
              </span>
            </button>
          </td>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-100">
        <% if @redirection_mappings.empty? %>
          <tr>
            <td colspan="5" class="py-12 text-center">
              <div class="flex flex-col items-center justify-center">
                <span class="text-2xl mb-2" aria-hidden="true">üîç</span>
                <span class="text-gray-500 text-lg font-medium" role="status">No results found</span>
                <span class="text-gray-400 text-sm mt-1">Try adjusting your search terms.</span>
              </div>
            </td>
          </tr>
        <% else %>
          <% @redirection_mappings.each do |mapping| %>
            <tr class="hover:bg-gray-50 text-sm">
              <td class="px-4 py-2 text-center">
                <input type="checkbox" name="ids[]" class="accent-gray-700" value="<%= mapping.id %>" data-action="change->redirection-mappings-index#selectRow" data-redirection-mappings-index-target="rowCheckbox">
              </td>
              <td class="p-2 font-medium text-gray-900">
                <%= link_to mapping.old_slug, edit_admin_redirection_mapping_path(mapping), class: "hover:text-sky-600 transition-colors" %>
              </td>
              <td class="p-2 font-medium text-gray-900">
                <%= link_to mapping.new_slug, edit_admin_redirection_mapping_path(mapping), class: "hover:text-sky-600 transition-colors" %>
              </td>
              <td class="p-2 text-gray-700 text-center"><%= render_boolean_badge(mapping.active) %></td>
              <td class="p-2 max-w-[180px] text-sm text-right">
                <div class="button-wrapper h-full flex gap-2 justify-end">
                  <%= render_action_button(edit_admin_redirection_mapping_path(mapping), icon: 'edit', type: :edit) %>
                  <%= render_action_button(admin_redirection_mapping_path(mapping), icon: 'delete', type: :delete, confirm_message: 'Are you sure you want to delete this redirection?') %>
                </div>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mb-2 flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>
</div>
