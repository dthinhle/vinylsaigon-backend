<%# Renders a promotions table and pagination. Locals: promotions (collection), pagy (optional), show_actions (optional, default true) %>
<% show_actions = true if show_actions.nil? %>

<div class="overflow-x-auto w-full border border-gray-200 rounded-lg">
  <table class="w-full max-w-full divide-y divide-gray-200 table-auto text-sm">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-2">
          <input type="checkbox" class="accent-gray-700" data-action="change->promotions-index#toggleAll" data-promotions-index-target="toggleAllCheckbox">
        </th>
        <%= render_promotion_table_headers(params) %>
      </tr>
      <%= render_bulk_actions_row(controller_name: 'promotions-index', colspan: 15, delete_path: destroy_selected_admin_promotions_path) %>
    </thead>

    <tbody class="bg-white divide-y divide-gray-100">
      <% if promotions.blank? %>
        <%= render_empty_state(colspan: 15) %>
      <% else %>
        <% promotions.each do |promotion| %>
          <tr data-promotion-id="<%= promotion.id %>">
            <td class="px-4 py-2">
              <input
                type="checkbox"
                value="<%= promotion.id %>"
                class="accent-gray-700"
                data-action="change->promotions-index#selectRow"
                data-promotions-index-target="rowCheckbox"
              >
            </td>

            <td class="px-4 py-2 font-medium text-gray-900">
              <%= link_to promotion.title, admin_promotion_path(promotion), class: "text-sky-600 hover:underline" %>
            </td>

            <td class="px-4 py-2 text-gray-700"><%= promotion.code %></td>

            <td class="px-4 py-2 text-gray-700"><%= promotion.discount_type %></td>

            <td class="px-4 py-2 text-gray-700">
              <% if promotion.percentage? %>
                <%= "#{promotion.discount_value.to_s}%" %>
              <% else %>
                <%= format_vnd_currency(promotion.discount_value.to_i) %>
              <% end %>
            </td>

            <td class="px-4 py-2 text-gray-700">
              <% if promotion.max_discount_amount_vnd.present? && promotion.max_discount_amount_vnd > 0 %>
                <%= format_vnd_currency(promotion.max_discount_amount_vnd) %>
              <% else %>
                No cap
              <% end %>
            </td>

            <td class="px-4 py-2 text-gray-700"><%= format_date(promotion.starts_at) %></td>
            <td class="px-4 py-2 text-gray-700"><%= format_date(promotion.ends_at) %></td>

            <td class="px-4 py-2 text-gray-700"><%= link_to promotion.usage_count, admin_promotion_promotion_usages_path(promotion) %></td>
            <td class="px-4 py-2 text-gray-700"><%= promotion.usage_limit || 'âˆž' %></td>

            <td class="px-4 py-2 text-center"><%= render_boolean_badge(promotion.active) %></td>

            <td class="px-4 py-2 text-right">
              <div class="button-wrapper h-full flex gap-2 justify-end">
                <%= render_action_button(edit_admin_promotion_path(promotion), icon: 'edit', type: :edit, data: { turbo: false }) %>
                <%= render_action_button(admin_promotion_path(promotion), icon: 'delete', type: :delete, confirm_message: 'Are you sure you want to delete this promotion?') %>
              </div>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>

<div class="mb-2 flex justify-end-safe">
  <%== pagy.series_nav if pagy %>
</div>
