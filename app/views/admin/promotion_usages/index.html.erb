<div class="flex flex-col gap-4">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold"><%= @promotion.present? ? "Usages for: #{@promotion.title}" : 'Promotion Usages' %></h1>
      <nav class="text-sm breadcrumbs mt-1">
        <ol class="inline-flex items-center space-x-1">
          <li><%= link_to "Admin", admin_dashboard_path, class: "text-gray-500 hover:text-gray-700" %></li>
          <li>/</li>
          <% if @promotion.present? %>
            <li><%= link_to "Promotions", admin_promotions_path, class: "text-gray-500 hover:text-gray-700" %></li>
            <li>/</li>
          <% end %>
          <li class="text-gray-900">Promotion Usages</li>
        </ol>
      </nav>
    </div>
    <div class="flex items-center gap-2">
      <% if @promotion.present? %>
        <%= link_to admin_promotion_path(@promotion), class: "btn btn-primary text-sm px-4 py-2 rounded bg-gray-950 hover:bg-gray-700 flex items-center transition cursor-pointer" do %>
          <span class="text-white">Back to Promotion</span>
        <% end %>
      <% else %>
        <%= link_to admin_promotions_path, class: "btn btn-primary text-sm px-4 py-2 rounded bg-gray-950 hover:bg-gray-700 flex items-center transition cursor-pointer" do %>
          <span class="material-icons text-white text-base! mr-2 -ml-1">loyalty</span>
          <span class="text-white">Promotions</span>
        <% end %>
      <% end %>
    </div>
  </div>

  <%# Use consistent filter bar styles used across admin pages (inputs, selects, and filter button) %>
  <% search_path = @promotion.present? ? admin_promotion_promotion_usages_path(@promotion) : admin_promotion_usages_path %>

  <div class="filter-wrapper w-full bg-white p-4 border border-gray-200 rounded-lg grid gap-4 mb-4">
    <%=
      render_filter_chips(
        filter_params: @filter_params,
        filter_labels: @filter_labels,
        clear_path: search_path
      )
    %>

    <div class="w-full max-w-full">
      <%= form_with url: search_path, method: :get, local: true, class: "flex flex-col md:flex-row md:items-end gap-2 md:gap-4 w-full max-w-full" do |f| %>
        <div class="flex flex-1 gap-2 md:gap-4 items-center">
          <div class="flex items-center gap-2">
            <label class="text-sm">Active</label>
            <select name="active" class="select select-bordered text-sm px-2 py-1 rounded border border-gray-300">
              <option value="">Any</option>
              <option value="only_active" <%= "selected" if params[:active] == "only_active" %>>Only active</option>
              <option value="only_inactive" <%= "selected" if params[:active] == "only_inactive" %>>Only inactive</option>
            </select>
          </div>

          <div class="flex items-center gap-2">
            <label class="text-sm">User Email</label>
            <input name="user_email" value="<%= params[:user_email] || '' %>" placeholder="email" class="input input-bordered text-sm px-3 py-2 rounded border border-gray-300">
          </div>

          <div class="flex items-center gap-2">
            <label class="text-sm">Promotion Code</label>
            <input name="promotion_code" value="<%= params[:promotion_code] || '' %>" placeholder="code" class="input input-bordered text-sm px-3 py-2 rounded border border-gray-300">
          </div>
        </div>

        <%= hidden_field_tag 'sort_by', params[:sort_by] %>
        <%= hidden_field_tag 'per_page', params[:per_page] %>

        <div class="flex items-end">
          <button type="submit" class="btn btn-secondary text-sm px-3 py-2 rounded bg-gray-950 text-gray-50 hover:bg-gray-700 cursor-pointer">Filter</button>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-2 flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy&.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>

  <div class="overflow-x-auto w-full border border-gray-200 rounded-lg">
    <table class="w-full max-w-full divide-y divide-gray-200 table-auto text-sm">
      <thead class="bg-gray-50">
        <tr>
          <%= render_promotion_usage_table_headers(params) %>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-100">
        <% if @usages.blank? %>
          <tr>
            <td colspan="8" class="py-8 text-center text-gray-500">
              <div class="flex flex-col items-center justify-center">
                <span class="text-2xl mb-2" aria-hidden="true">üîç</span>
                <span class="text-gray-500 text-lg font-medium" role="status">No usages found</span>
                <span class="text-gray-400 text-sm mt-1">Try adjusting your filters or search terms.</span>
              </div>
            </td>
          </tr>
        <% else %>
          <% @usages.each do |usage| %>
            <%= render partial: 'admin/promotion_usages/usage_row', locals: { usage: usage, promotion: @promotion } %>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mb-2 flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy&.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>
</div>
