<div class="flex flex-col gap-4" data-controller="blogs-index">
  <%= render 'admin/shared/page_header',
    title: 'Blogs',
    button_text: 'Create Blog',
    button_path: new_admin_blog_path %>

  <div class="filter-wrapper w-full bg-white p-4 border border-gray-200 rounded-lg grid gap-4">
    <% filter_params = params.permit(:q, :slug, :status, :sort, :direction).to_h %>
    <% filter_labels = {
      "q" => "Search",
      "slug" => "Slug",
      "status" => "Status",
      "sort" => "Sort",
      "direction" => "Direction"
    } %>
    <%= render_filter_chips(
      filter_params: filter_params,
      filter_labels: filter_labels,
      clear_path: admin_blogs_path
    ) %>

    <div class="w-full max-w-full">
      <%= form_with url: admin_blogs_path, method: :get, local: true, class: "flex flex-col md:flex-row md:items-end gap-2 md:gap-4 w-full max-w-full" do |f| %>
        <div class="flex flex-col md:flex-row gap-2 md:gap-4 flex-1">
          <div class="flex flex-col">
            <input id="q" type="search" name="q" value="<%= params[:q] %>" placeholder="Search blogs..." class="input input-bordered text-sm w-full max-w-full px-3 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-sky-500" autocomplete="off">
          </div>
          <div class="flex flex-col">
            <input id="slug" type="search" name="slug" value="<%= params[:slug] %>" placeholder="Slug..." class="input input-bordered text-sm w-full max-w-full px-3 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-sky-500" autocomplete="off">
          </div>
          <div class="flex flex-col">
            <select id="status" name="status" class="select select-bordered text-sm px-3 py-[0.575rem] rounded border border-gray-300">
              <option value="">All Statuses</option>
              <% Blog.statuses.keys.each do |key| %>
                <option value="<%= key %>" <%= "selected" if params[:status] == key %>><%= key.titleize %></option>
              <% end %>
            </select>
          </div>
        </div>
        <div class="flex flex-col justify-end">
          <button type="submit" class="btn btn-secondary text-sm px-3 py-2 rounded bg-gray-950 text-gray-50 hover:bg-gray-700 cursor-pointer">Filter</button>
        </div>
      <% end %>
    </div>
  </div>

  <div class="flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy&.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>

  <div class="overflow-x-auto w-full border border-gray-200 rounded-lg">
    <table class="w-full max-w-full divide-y  divide-gray-200 table-auto">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2">
            <input type="checkbox" class="accent-gray-700" data-action="change->blogs-index#toggleAll" data-blogs-index-target="toggleAllCheckbox">
          </th>
          <%= render_blog_table_headers(params) %>
        </tr>
        <%= render_bulk_actions_row(controller_name: 'blogs-index', colspan: 9) %>
      </thead>
      <tbody class="bg-white divide-y divide-gray-100">
        <% if @blogs.empty? %>
          <%= render_empty_state(colspan: 9) %>
        <% else %>
          <% @blogs.each do |blog| %>
            <tr class="hover:bg-gray-50 text-sm">
              <td class="px-4 py-2">
                <input
                  type="checkbox"
                  value="<%= blog.id %>"
                  class="accent-gray-700"
                  data-action="change->blogs-index#selectRow"
                  data-blogs-index-target="rowCheckbox"
                >
              </td>
              <td class="px-4 py-2 font-medium text-gray-900"><%= link_to truncate(blog.title, length: 40) , admin_blog_path(blog), class: "hover:underline", data: {turbo: false} %></td>
              <td class="px-4 py-2 text-gray-700"><%= blog.slug %></td>
              <td class="px-4 py-2 text-gray-700"><%= blog.category&.name %></td>
              <td class="px-4 py-2 text-gray-700"><%= blog.author&.name %></td>
              <td class="px-4 py-2 text-gray-700"><%= format_datetime(blog.created_at) %></td>
              <td class="px-4 py-2 text-gray-700"><%= format_datetime(blog.published_at) %></td>
              <td class="p-2">
                <% if blog.published? %>
                  <span class="inline-block px-2 py-1 text-xs rounded bg-green-100 text-green-800">Published</span>
                <% elsif blog.draft? %>
                  <span class="inline-block px-2 py-1 text-xs rounded bg-gray-200 text-gray-700">Draft</span>
                <% elsif blog.archived? %>
                  <span class="inline-block px-2 py-1 text-xs rounded bg-amber-100 text-amber-800">Archived</span>
                <% else %>
                  <span class="inline-block px-2 py-1 text-xs rounded bg-gray-200 text-gray-700"><%= blog.status.to_s.humanize %></span>
                <% end %>
              </td>
              <td class="p-2 max-w-[180px] text-sm text-right">
                <div class="button-wrapper h-full flex gap-2 justify-end">
                  <%= render_action_button(edit_admin_blog_path(blog), icon: 'edit', type: :edit, data: {turbo: false}) %>
                  <%= render_action_button(admin_blog_path(blog), icon: 'delete', type: :delete, confirm_message: 'Are you sure you want to delete this blog?') %>
                </div>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mb-2 flex justify-between items-end">
    <span class="text-sm text-gray-500">Total: <%= @pagy&.count %></span>
    <%== @pagy.series_nav if @pagy %>
  </div>
</div>
