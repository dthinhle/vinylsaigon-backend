<%#
  Reusable partial for dynamic key-value attribute input.
  Required locals:
    - form: form builder
    - field_name: string (name for the hidden field)
    - initial_attributes: hash (initial key-value pairs)
    - input_label: string (optional, label for the field)
%>
<div
  data-controller="variant-attributes"
  data-variant-attributes-field-name-value="<%= field_name %>"
  data-variant-attributes-initial-value-value="<%= initial_attributes.to_json %>"
  class="max-w mx-auto bg-white rounded mb-4"
>
  <% if defined?(input_label) && input_label.present? %>
    <label class="block text-sm font-medium text-gray-700 mb-1"><%= input_label %></label>
  <% end %>
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-300 rounded shadow-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300">Key</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300">Value</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-300"></th>
        </tr>
      </thead>
      <tbody data-variant-attributes-target="rows" class="divide-y divide-gray-200"></tbody>
    </table>
  </div>
  <button
    type="button"
    data-action="variant-attributes#addRow"
    class="mt-2 bg-gray-950 hover:bg-gray-700 text-white text-sm font-semibold py-1.5 px-3 rounded transition-colors flex flex-row items-center"
  >
    <span class="material-icons text-base/6! align-middle mr-1">add</span>
    <span>Add attribute</span>
  </button>
  <%= form.hidden_field field_name, value: initial_attributes.to_json, data: { variant_attributes_target: "hidden" } %>
  <template data-variant-attributes-target="rowTemplate">
    <tr>
      <td class="px-4 py-2 align-middle" style="vertical-align: middle;">
        <input
          type="text"
          name="key"
          class="w-full px-3 py-2 h-10 rounded focus:outline-none focus:ring focus:border-sky-500 mb-1 font-sans min-h-0 appearance-none box-border leading-normal"
          placeholder="Enter key"
          autocomplete="off"
          data-variant-attributes-target="keyInput"
        />
      </td>
      <td class="px-4 py-2 align-middle" style="vertical-align: middle;">
        <textarea
          name="value"
          rows="1"
          class="mt-1 w-full px-3 py-2 h-10 rounded focus:outline-none focus:ring focus:border-sky-500 mb-1 font-sans min-h-0 appearance-none resize-none box-border leading-normal"
          placeholder="Enter value"
          autocomplete="off"
          data-variant-attributes-target="valueInput"
        ></textarea>
      </td>
      <td class="px-4 py-2 align-middle text-right" style="vertical-align: middle;">
        <button
          type="button"
          data-action="variant-attributes#removeRow"
          class="bg-red-600 hover:bg-red-700 text-white font-semibold py-1.5 px-3 rounded transition-colors flex items-center justify-center"
          aria-label="Remove attribute"
        >
          <span class="material-icons" style="font-size:1.25rem;color:white;" aria-hidden="true">delete</span>
        </button>
      </td>
    </tr>
    <% if (defined?(key_error) && key_error.present?) || (defined?(value_error) && value_error.present?) %>
      <tr>
        <td colspan="3" class="px-4 py-2 text-xs text-red-600 bg-red-50 rounded">
          <% if defined?(key_error) && key_error.present? %>
            <div><%= key_error %></div>
          <% end %>
          <% if defined?(value_error) && value_error.present? %>
            <div><%= value_error %></div>
          <% end %>
        </td>
      </tr>
    <% end %>
  </template>
</div>
