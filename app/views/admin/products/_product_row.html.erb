<%# Renders a single product row %>
<% show_actions = true if show_actions.nil? %>

<% if @brand.present? %>
  <tr class="hover:bg-gray-50 text-sm">
    <td class="p-2 font-medium text-gray-900"><%= product.id %></td>
    <td class="p-2 font-medium text-gray-900"><%= product.name %></td>
    <td class="p-2 text-gray-700"><%= product.sku.presence || '-' %></td>
    <td class="p-2 text-gray-700 text-right"><%= format_price(product.original_price) %></td>
    <td class="p-2">
      <% case product.status
         when "active" %>
        <span class="inline-block px-2 py-1 text-xs rounded bg-green-100 text-green-800">Published</span>
      <% when "inactive" %>
        <span class="inline-block px-2 py-1 text-xs rounded bg-gray-200 text-gray-700">Inactive</span>
      <% when "discontinued" %>
        <span class="inline-block px-2 py-1 text-xs rounded bg-amber-100 text-amber-800">Discontinued</span>
      <% else %>
        <span class="inline-block px-2 py-1 text-xs rounded bg-gray-200 text-gray-700"><%= product.status.to_s.humanize %></span>
      <% end %>
    </td>

    <td class="p-2 text-gray-700 text-nowrap"><%= format_datetime(product.created_at) %></td>

    <% if show_actions %>
      <td class="p-2 max-w-[180px] text-sm text-right">
        <div class="button-wrapper h-full flex gap-2 justify-end">
          <%= render_action_button(edit_admin_product_path(product), icon: 'edit', type: :edit, data: { turbo: false }) %>
          <%= render_action_button(admin_product_path(product), icon: 'delete', type: :delete, confirm_message: 'Are you sure you want to delete this product?') %>
        </div>
      </td>
    <% end %>

  </tr>
<% else %>
  <tr class="hover:bg-gray-50 text-sm">
    <td class="px-4 py-2 text-center">
      <input type="checkbox" name="ids[]" class="accent-gray-700" value="<%= product.id %>" data-action="change->products-index#selectRow" data-products-index-target="rowCheckbox">
    </td>

    <td class="p-2 font-medium text-gray-900 min-w-60">
      <%= link_to product.name, edit_admin_product_path(product), data: { turbo: false } %>
    </td>

    <td class="p-2 text-gray-700 max-w-32 truncate"><%= product.sku.presence || '-' %></td>
    <% if  product.category.is_root? %>
      <td class="p-2 text-red-600 text-nowrap"><%= product.category.try(:title) %></td>
    <% else %>
      <td class="p-2 text-gray-700 text-nowrap">
        <%= product.category.try(:title) %> <span class="text-sm">(<%= product.category.parent.try(:title) %>)</span>
      </td>
    <% end %>
    <td class="p-2 text-gray-700"><%= product.brands.pluck(:name).to_sentence %></td>

    <td class="p-2 text-gray-700">
      <div class="flex flex-wrap">
      <% if product.flags.present? %>
        <% product.flags.each do |flag| %>
          <span class="inline-block bg-sky-100 text-sky-800 rounded px-2 py-1 text-xs mr-1 mb-1 text-nowrap"><%= flag.titleize %></span>
        <% end %>
      <% else %>
        <span class="text-gray-400 text-xs">-</span>
      <% end %>
      </div>
    </td>

    <td class="p-2 text-gray-700 text-right text-nowrap"><%= format_price(product.original_price) %></td>
    <td class="p-2 text-gray-700 text-right text-nowrap"><%= format_price(product.current_price) if product.current_price %></td>

    <td class="p-2">
      <% case product.status
         when "active" %>
        <span class="inline-block text-nowrap px-2 py-1 text-xs rounded bg-green-100 text-green-800">Published</span>
      <% when "inactive" %>
        <span class="inline-block text-nowrap px-2 py-1 text-xs rounded bg-gray-200 text-gray-700">Inactive</span>
      <% when "discontinued" %>
        <span class="inline-block text-nowrap px-2 py-1 text-xs rounded bg-amber-100 text-amber-800">Discontinued</span>
      <% when "temporarily_unavailable" %>
        <span class="inline-block text-nowrap px-2 py-1 text-xs rounded bg-amber-100 text-amber-800">Temp Unavailable</span>
      <% else %>
        <span class="inline-block text-nowrap px-2 py-1 text-xs rounded bg-gray-200 text-gray-700"><%= product.status.to_s.humanize %></span>
      <% end %>
    </td>

    <td class="p-2 text-gray-700 text-nowrap"><%= format_datetime(product.updated_at) %></td>
    <td class="p-2 text-gray-700 text-nowrap"><%= format_datetime(product.created_at) %></td>

    <% if show_actions %>
      <td class="p-2 max-w-[180px] text-sm text-right sticky bg-white right-0 z-10">
        <div class="button-wrapper h-full flex gap-2 justify-end">
          <%= render_action_button(edit_admin_product_path(product), icon: 'edit', type: :edit, data: { turbo: false }) %>
          <%= render_action_button(admin_product_path(product), icon: 'delete', type: :delete, confirm_message: 'Are you sure you want to delete this product?') %>
        </div>
      </td>
    <% end %>
  </tr>
<% end %>
